<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Finatra by capotej</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Finatra</h1>
        <p>finagle + sinatra</p>

        <p class="view"><a href="https://github.com/capotej/finatra">View the Project on GitHub <small>capotej/finatra</small></a></p>


        <ul>
          <li><a href="https://github.com/capotej/finatra/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/capotej/finatra/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/capotej/finatra">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Finatra</h1>

<h3>Description</h3>

<p>Finatra is a sinatra clone backed by scala/finagle written by <a href="http://twitter.com/capotej">@capotej</a> and <a href="http://twitter.com/twoism">@twoism</a></p>

<h3>Features</h3>

<ul>
<li><p>The routing DSL you've come to know and love</p></li>
<li><p>Asynchronous, uses Finagle-HTTP/Netty</p></li>
<li><p>Multipart file upload/form handling</p></li>
<li><p>Modular app support</p></li>
<li><p>A testing helper</p></li>
<li><p>Built in static file server (note: not designed for huge files(&gt;100mb))</p></li>
<li><p>Mustache template support through <a href="https://github.com/spullara/mustache.java">mustache.java</a></p></li>
</ul><h3>TODO</h3>

<ul>
<li><p>Make file serving more efficient / Use an LRU map</p></li>
<li><p>Plugin api</p></li>
</ul><h3>Installation via RubyGems</h3>

<pre><code>$ gem install finatra

$ finatra new MyApp
Org Name (com.&lt;username&gt;) com.twitter
[finatra] :: Creating MyApp in /Users/cburnett/dev...
  create  myapp
  create  myapp/Procfile
  create  myapp/README.markdown
  create  myapp/pom.xml
  create  myapp/src/main/scala/com/twitter/myapp/MyApp.scala
  create  myapp/src/test/scala/com/twitter/myapp/MyAppSpec.scala
  create  myapp/src/main/resources/timeline.mustache
</code></pre>

<h3>Start the Server</h3>

<pre><code>$ finatra start
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building MyApp 0.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] No known dependencies. Compiling everything
[INFO] launcher 'main' selected =&gt; com.twitter.myapp.App
started on 7070: view logs/finatra.log for more info
</code></pre>

<h2>Other Commands</h2>

<pre><code>$ finatra
Tasks:
  finatra compile          # Compile your app with Maven
  finatra console          # Starts a scala console
  finatra help [TASK]      # Describe available tasks or one specific task
  finatra new &lt;MyAppName&gt;  # Create a new Finatra app
  finatra package          # Package a jar for your app
  finatra start            # Run your app on port 7070
  finatra test             # Run the tests
</code></pre>

<h3>Installation via Maven</h3>

<p>Add the repo and dependency to your pom.xml (sbt users to the left)</p>

<div class="highlight">
<pre><span class="nt">&lt;repositories&gt;</span>
  <span class="nt">&lt;repository&gt;</span>
    <span class="nt">&lt;id&gt;</span>repo.juliocapote.com<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://repo.juliocapote.com<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/repositories&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.twitter<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>finatra<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.1.7<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre>
</div>


<h3>Configuring</h3>

<p>import finatra</p>

<div class="highlight">
<pre><span class="k">import</span> <span class="nn">com.twitter.finatra.</span><span class="o">{</span><span class="nc">FinatraServer</span><span class="o">,</span> <span class="nc">Controller</span><span class="o">,</span> <span class="nc">View</span><span class="o">}</span>
</pre>
</div>


<p>add your apps</p>

<div class="highlight">
<pre><span class="k">val</span> <span class="n">exampleApp</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ExampleApp</span>
<span class="k">val</span> <span class="n">myResource</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MyResource</span>

<span class="nc">FinatraServer</span><span class="o">.</span><span class="n">register</span><span class="o">(</span><span class="n">exampleApp</span><span class="o">)</span>
<span class="nc">FinatraServer</span><span class="o">.</span><span class="n">register</span><span class="o">(</span><span class="n">myResource</span><span class="o">)</span>
</pre>
</div>


<p>start the server</p>

<div class="highlight">
<pre><span class="nc">FinatraServer</span><span class="o">.</span><span class="n">start</span><span class="o">()</span> <span class="c1">//Defaults: 7070, "docroot"</span>
</pre>
</div>


<h3>Example project</h3>

<p>Check out <a href="http://github.com/capotej/finatra-helloworld">finatra-helloworld</a> for an example finatra project</p>

<p>Here's an <a href="https://gist.github.com/2626200">example blog</a></p>

<h3>API</h3>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">tweets</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="k">new</span> <span class="nc">Tweet</span><span class="o">(</span><span class="s">"hey!"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Tweet</span><span class="o">(</span><span class="s">"lol"</span><span class="o">))</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/cookies"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">).</span><span class="n">header</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/html"</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/tweets.json"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="n">tweets</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/status/:status"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">statusCode</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">(</span><span class="s">"status"</span><span class="o">).</span><span class="n">toInt</span>

    <span class="n">render</span><span class="o">.</span><span class="n">nothing</span><span class="o">.</span><span class="n">status</span><span class="o">(</span><span class="n">statusCode</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/not_found"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">nothing</span><span class="o">.</span><span class="n">notFound</span>
  <span class="o">}</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/headers"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">nothing</span><span class="o">.</span><span class="n">header</span><span class="o">(</span><span class="s">"X-GitSHA"</span><span class="o">,</span> <span class="s">"1ecd6b1"</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre>
</div>


<h3>Views</h3>

<div class="highlight">
<pre>
<span class="k">class</span> <span class="nc">TimelineView</span><span class="o">(</span><span class="k">val</span> <span class="n">tweets</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Tweet</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">View</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">template</span> <span class="k">=</span> <span class="s">"timeline.mustache"</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">tweets</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="k">new</span> <span class="nc">Tweet</span><span class="o">(</span><span class="s">"hey!"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Tweet</span><span class="o">(</span><span class="s">"lol"</span><span class="o">))</span>

  <span class="n">get</span><span class="o">(</span><span class="s">"/tweets"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">tweetsView</span>  <span class="k">=</span> <span class="k">new</span> <span class="nc">TimelineView</span><span class="o">(</span><span class="n">tweets</span><span class="o">)</span>

    <span class="n">render</span><span class="o">.</span><span class="n">view</span><span class="o">(</span><span class="n">tweetsView</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre>
</div>


<h3>File Uploads</h3>

<div class="highlight">
<pre><span class="k">import</span> <span class="nn">com.twitter.finatra._</span>

<span class="k">object</span> <span class="nc">UploadExample</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="c1">//Example curl:</span>
  <span class="c1">//curl -F myfile=@/home/capotej/images/bad-advice-cat.jpeg http://localhost:7070/upload</span>

  <span class="c1">//the multiPart method returns MultiPartItem objects, which have some handy methods</span>
  <span class="n">post</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>

    <span class="n">request</span><span class="o">.</span><span class="n">multiParams</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"myfile"</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="k">=&gt;</span>

        <span class="c1">//get the content type</span>
        <span class="n">file</span><span class="o">.</span><span class="n">contentType</span>

        <span class="c1">//get the data</span>
        <span class="n">file</span><span class="o">.</span><span class="n">data</span>

        <span class="c1">//get the uploaded filename</span>
        <span class="n">file</span><span class="o">.</span><span class="n">filename</span>

        <span class="c1">//copy the file somewhere</span>
        <span class="n">file</span><span class="o">.</span><span class="n">writeToFile</span><span class="o">(</span><span class="s">"/tmp/uploadedfile.jpg"</span><span class="o">)</span>
        <span class="n">render</span><span class="o">.</span><span class="n">ok</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
        <span class="n">render</span><span class="o">.</span><span class="n">notFound</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>


  <span class="c1">//Form Example</span>
  <span class="c1">//curl -F foo=bar http://localhost:7070/formsubmit</span>

  <span class="n">post</span><span class="o">(</span><span class="s">"/formsubmit"</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="n">request</span><span class="o">.</span><span class="n">multiParams</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">data</span> <span class="c1">// "bar"</span>
  <span class="o">}</span>


</pre>
</div>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/capotej">capotej</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>